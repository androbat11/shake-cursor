# Events and CPU Efficiency

## What is an Event?

An **event** is a signal that something happened. It's a notification from one part of the system to another saying: "this thing just occurred, react to it if you care."

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Real World Analogy                       â”‚
â”‚                                                             â”‚
â”‚   POLLING (you check):                                      â”‚
â”‚                                                             â”‚
â”‚   You walk to the mailbox every 5 minutes:                  â”‚
â”‚     8:00 - check mailbox â†’ empty                            â”‚
â”‚     8:05 - check mailbox â†’ empty                            â”‚
â”‚     8:10 - check mailbox â†’ empty                            â”‚
â”‚     8:15 - check mailbox â†’ empty                            â”‚
â”‚     8:20 - check mailbox â†’ LETTER!                          â”‚
â”‚                                                             â”‚
â”‚   You wasted 4 trips for nothing.                           â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚   EVENT-DRIVEN (mailbox tells you):                         â”‚
â”‚                                                             â”‚
â”‚   Mailbox has a bell. You sit and relax.                    â”‚
â”‚     8:00 - relaxing...                                      â”‚
â”‚     8:05 - relaxing...                                      â”‚
â”‚     8:10 - relaxing...                                      â”‚
â”‚     8:15 - relaxing...                                      â”‚
â”‚     8:20 - ğŸ”” DING! â†’ you go get the letter                 â”‚
â”‚                                                             â”‚
â”‚   Zero wasted effort. You only act when notified.           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Events in System Programming

In system programming, events are notifications generated by the **operating system kernel** or by other programs. They signal that something meaningful occurred.

### Types of Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Event Sources                                 â”‚
â”‚                                                                     â”‚
â”‚   HARDWARE EVENTS (generated by devices):                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ Mouse moved to (x, y)                                    â”‚   â”‚
â”‚   â”‚  â€¢ Mouse button pressed/released                            â”‚   â”‚
â”‚   â”‚  â€¢ Key pressed/released                                     â”‚   â”‚
â”‚   â”‚  â€¢ USB device connected                                     â”‚   â”‚
â”‚   â”‚  â€¢ Network packet arrived                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   SOFTWARE EVENTS (generated by programs):                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ File was modified on disk                                â”‚   â”‚
â”‚   â”‚  â€¢ Timer expired                                            â”‚   â”‚
â”‚   â”‚  â€¢ Child process finished                                   â”‚   â”‚
â”‚   â”‚  â€¢ Signal received (SIGTERM, SIGINT)                        â”‚   â”‚
â”‚   â”‚  â€¢ Data available on a socket                               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   WINDOW SYSTEM EVENTS (generated by display server):               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ MotionNotify â€” cursor moved                              â”‚   â”‚
â”‚   â”‚  â€¢ ButtonPress â€” mouse button clicked                       â”‚   â”‚
â”‚   â”‚  â€¢ KeyPress â€” keyboard key pressed                          â”‚   â”‚
â”‚   â”‚  â€¢ Expose â€” window needs redrawing                          â”‚   â”‚
â”‚   â”‚  â€¢ ConfigureNotify â€” window was resized/moved               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Event Lifecycle

An event travels from its source to the program that handles it:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Event Lifecycle                                â”‚
â”‚                                                                    â”‚
â”‚  1. SOMETHING HAPPENS                                              â”‚
â”‚     User moves mouse                                               â”‚
â”‚     â”‚                                                              â”‚
â”‚     â–¼                                                              â”‚
â”‚  2. HARDWARE GENERATES SIGNAL                                      â”‚
â”‚     Mouse sends electrical signal to computer                      â”‚
â”‚     â”‚                                                              â”‚
â”‚     â–¼                                                              â”‚
â”‚  3. KERNEL RECEIVES IT                                             â”‚
â”‚     Linux kernel reads from /dev/input/event*                      â”‚
â”‚     Kernel creates an input event struct:                          â”‚
â”‚     { type: EV_REL, code: REL_X, value: +5 }                      â”‚
â”‚     â”‚                                                              â”‚
â”‚     â–¼                                                              â”‚
â”‚  4. DISPLAY SERVER RECEIVES IT                                     â”‚
â”‚     X server reads from kernel via evdev/libinput                  â”‚
â”‚     Converts to X11 event:                                         â”‚
â”‚     MotionNotify { x: 505, y: 300, time: 12345 }                  â”‚
â”‚     â”‚                                                              â”‚
â”‚     â–¼                                                              â”‚
â”‚  5. APPLICATION RECEIVES IT                                        â”‚
â”‚     shake-cursor receives the MotionNotify event                   â”‚
â”‚     Analyzes position for shake pattern                            â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Event-Driven Architecture

An **event-driven architecture** is when your program's flow is controlled by events rather than by a sequential loop.

### The Event Loop

At the core of every event-driven program is an **event loop**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Event Loop                             â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â”‚   1. WAIT for next event  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
â”‚   â”‚      (program SLEEPS here)              â”‚   â”‚           â”‚
â”‚   â”‚      â”‚                                  â”‚   â”‚           â”‚
â”‚   â”‚      â–¼                                  â”‚   â”‚           â”‚
â”‚   â”‚   2. EVENT arrives                      â”‚   â”‚           â”‚
â”‚   â”‚      (program WAKES up)                 â”‚   â”‚           â”‚
â”‚   â”‚      â”‚                                  â”‚   â”‚           â”‚
â”‚   â”‚      â–¼                                  â”‚   â”‚           â”‚
â”‚   â”‚   3. HANDLE the event                   â”‚   â”‚           â”‚
â”‚   â”‚      (run your code)                    â”‚   â”‚           â”‚
â”‚   â”‚      â”‚                                  â”‚   â”‚           â”‚
â”‚   â”‚      â–¼                                  â”‚   â”‚           â”‚
â”‚   â”‚   4. Go back to WAIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚   â”‚                                             â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                             â”‚
â”‚   In pseudocode:                                            â”‚
â”‚                                                             â”‚
â”‚   loop {                                                    â”‚
â”‚       event = wait_for_next_event()  // BLOCKS (sleeps)     â”‚
â”‚       match event {                                         â”‚
â”‚           MotionNotify(x, y) => analyze_shake(x, y),        â”‚
â”‚           Quit => break,                                    â”‚
â”‚       }                                                     â”‚
â”‚   }                                                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

The critical word is **BLOCKS** â€” when there are no events, the program is **asleep**. The kernel has paused it. It uses **zero CPU**.

## Why Event-Driven Uses Less CPU

### What CPU Actually Does

The CPU executes instructions. Every instruction costs energy and time:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   CPU has two states:                                       â”‚
â”‚                                                             â”‚
â”‚   RUNNING:  Executing instructions                          â”‚
â”‚             Uses power, generates heat                      â”‚
â”‚             Costs CPU time (other programs get less)         â”‚
â”‚                                                             â”‚
â”‚   SLEEPING: Waiting for something to happen                 â”‚
â”‚             Uses almost no power                            â”‚
â”‚             Costs nothing (other programs run freely)        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Polling: CPU is Always RUNNING

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     POLLING CPU Usage                                â”‚
â”‚                                                                     â”‚
â”‚   Time    Mouse Moving?    What Program Does          CPU State     â”‚
â”‚   â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   0ms     No               XQueryPointer() â†’ (100,200)  RUNNING    â”‚
â”‚   10ms    No               XQueryPointer() â†’ (100,200)  RUNNING    â”‚
â”‚   20ms    No               XQueryPointer() â†’ (100,200)  RUNNING    â”‚
â”‚   30ms    No               XQueryPointer() â†’ (100,200)  RUNNING    â”‚
â”‚   40ms    No               XQueryPointer() â†’ (100,200)  RUNNING    â”‚
â”‚   50ms    YES              XQueryPointer() â†’ (120,210)  RUNNING    â”‚
â”‚   60ms    YES              XQueryPointer() â†’ (140,220)  RUNNING    â”‚
â”‚   70ms    No               XQueryPointer() â†’ (140,220)  RUNNING    â”‚
â”‚   80ms    No               XQueryPointer() â†’ (140,220)  RUNNING    â”‚
â”‚   90ms    No               XQueryPointer() â†’ (140,220)  RUNNING    â”‚
â”‚                                                                     â”‚
â”‚   10 cycles, 10 CPU wakeups                                         â”‚
â”‚   Only 2 had actual mouse movement                                  â”‚
â”‚   80% of CPU time was WASTED                                        â”‚
â”‚                                                                     â”‚
â”‚   CPU usage over time:                                              â”‚
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (constant)               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event-Driven: CPU Only RUNS When Needed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EVENT-DRIVEN CPU Usage                             â”‚
â”‚                                                                     â”‚
â”‚   Time    Mouse Moving?    What Program Does          CPU State     â”‚
â”‚   â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚   0ms     No               sleeping...                SLEEPING      â”‚
â”‚   10ms    No               sleeping...                SLEEPING      â”‚
â”‚   20ms    No               sleeping...                SLEEPING      â”‚
â”‚   30ms    No               sleeping...                SLEEPING      â”‚
â”‚   40ms    No               sleeping...                SLEEPING      â”‚
â”‚   50ms    YES              MotionNotify! â†’ handle     RUNNING â†     â”‚
â”‚   60ms    YES              MotionNotify! â†’ handle     RUNNING â†     â”‚
â”‚   70ms    No               sleeping...                SLEEPING      â”‚
â”‚   80ms    No               sleeping...                SLEEPING      â”‚
â”‚   90ms    No               sleeping...                SLEEPING      â”‚
â”‚                                                                     â”‚
â”‚   10 time slots, only 2 CPU wakeups                                 â”‚
â”‚   CPU was sleeping for 80% of the time                              â”‚
â”‚   Only woke up when there was actual work to do                     â”‚
â”‚                                                                     â”‚
â”‚   CPU usage over time:                                              â”‚
â”‚   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (spikes only on events) â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Direct Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   Scenario: User moves mouse for 2 seconds, then stops for 58      â”‚
â”‚   seconds. One full minute.                                         â”‚
â”‚                                                                     â”‚
â”‚   POLLING (every 10ms):                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Total iterations:  6,000  (100 per second Ã— 60 seconds)   â”‚   â”‚
â”‚   â”‚  Useful iterations:   200  (only during 2 seconds of motion)â”‚   â”‚
â”‚   â”‚  Wasted iterations: 5,800  (96.7% wasted!)                 â”‚   â”‚
â”‚   â”‚  CPU state: ALWAYS RUNNING                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   EVENT-DRIVEN:                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Total wakeups:    ~200   (only during mouse movement)      â”‚   â”‚
â”‚   â”‚  Useful wakeups:   ~200   (all of them)                     â”‚   â”‚
â”‚   â”‚  Wasted wakeups:     0    (0% wasted!)                      â”‚   â”‚
â”‚   â”‚  CPU state: SLEEPING 96.7% of the time                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   Event-driven used ~30x less CPU in this scenario.                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## How Sleeping Works (The Kernel's Role)

When a program says "wait for next event," this is what happens at the OS level:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   How Blocking/Sleeping Works                       â”‚
â”‚                                                                     â”‚
â”‚   1. shake-cursor calls: wait_for_event()                           â”‚
â”‚      â”‚                                                              â”‚
â”‚      â–¼                                                              â”‚
â”‚   2. This translates to a system call: read() on the X11 socket    â”‚
â”‚      â”‚                                                              â”‚
â”‚      â–¼                                                              â”‚
â”‚   3. Kernel checks: is there data on this socket?                   â”‚
â”‚      â”‚                                                              â”‚
â”‚      â”œâ”€â”€ YES â†’ return data immediately, program continues           â”‚
â”‚      â”‚                                                              â”‚
â”‚      â””â”€â”€ NO â†’ Kernel puts the process to sleep:                     â”‚
â”‚               â”‚                                                     â”‚
â”‚               â–¼                                                     â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚               â”‚  Process State: SLEEPING                     â”‚       â”‚
â”‚               â”‚                                             â”‚       â”‚
â”‚               â”‚  â€¢ Removed from CPU run queue               â”‚       â”‚
â”‚               â”‚  â€¢ Uses ZERO CPU cycles                     â”‚       â”‚
â”‚               â”‚  â€¢ Other programs get the CPU               â”‚       â”‚
â”‚               â”‚  â€¢ Process just sits in memory, doing       â”‚       â”‚
â”‚               â”‚    absolutely nothing                       â”‚       â”‚
â”‚               â”‚                                             â”‚       â”‚
â”‚               â”‚  Kernel adds to wait queue:                 â”‚       â”‚
â”‚               â”‚  "Wake shake-cursor when data arrives       â”‚       â”‚
â”‚               â”‚   on socket /tmp/.X11-unix/X0"             â”‚       â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â”‚ (time passes... no events...)        â”‚
â”‚                              â”‚                                      â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚               â”‚  Mouse moves! X server writes to socket.    â”‚       â”‚
â”‚               â”‚                                             â”‚       â”‚
â”‚               â”‚  Kernel detects data on socket:             â”‚       â”‚
â”‚               â”‚  "shake-cursor was waiting for this!"       â”‚       â”‚
â”‚               â”‚                                             â”‚       â”‚
â”‚               â”‚  Process State: RUNNING                     â”‚       â”‚
â”‚               â”‚  Process wakes up, receives the event.      â”‚       â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Key Insight

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   POLLING:                                                  â”‚
â”‚   Your program does the work of checking.                   â”‚
â”‚   "Is there an event? No. Is there an event? No. Isâ€”"      â”‚
â”‚   CPU is busy asking over and over.                         â”‚
â”‚                                                             â”‚
â”‚   EVENT-DRIVEN:                                             â”‚
â”‚   The kernel does the work of watching.                     â”‚
â”‚   Your program sleeps. The kernel wakes it up.              â”‚
â”‚   The kernel is already watching the hardware anyway        â”‚
â”‚   (it has to for ALL programs), so this costs nothing       â”‚
â”‚   extra.                                                    â”‚
â”‚                                                             â”‚
â”‚   It's the difference between:                              â”‚
â”‚   â€¢ YOU repeatedly opening the door to check for mail       â”‚
â”‚   â€¢ The DOORBELL ringing when mail arrives                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## How This Applies to shake-cursor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   shake-cursor (event-driven):                                      â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  1. Connect to X server                                   â”‚      â”‚
â”‚   â”‚  2. Subscribe to MotionNotify on root window              â”‚      â”‚
â”‚   â”‚  3. Enter event loop:                                     â”‚      â”‚
â”‚   â”‚                                                          â”‚      â”‚
â”‚   â”‚     loop {                                                â”‚      â”‚
â”‚   â”‚         event = next_event()     // sleeps here           â”‚      â”‚
â”‚   â”‚                                                          â”‚      â”‚
â”‚   â”‚         if event is MotionNotify {                        â”‚      â”‚
â”‚   â”‚             record position + timestamp                   â”‚      â”‚
â”‚   â”‚             if recent positions show shake pattern {      â”‚      â”‚
â”‚   â”‚                 enlarge cursor                            â”‚      â”‚
â”‚   â”‚             }                                             â”‚      â”‚
â”‚   â”‚         }                                                â”‚      â”‚
â”‚   â”‚     }                                                     â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚   CPU usage:                                                        â”‚
â”‚   â€¢ User not moving mouse â†’ 0% CPU (sleeping)                       â”‚
â”‚   â€¢ User moving mouse normally â†’ tiny spikes (brief wakeups)        â”‚
â”‚   â€¢ User shaking cursor â†’ small burst (detect + enlarge cursor)     â”‚
â”‚   â€¢ Perfect for a background daemon!                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

| Concept | Definition |
|---------|------------|
| **Event** | A notification that something happened (mouse moved, key pressed, etc.) |
| **Event loop** | A loop that sleeps until an event arrives, handles it, then sleeps again |
| **Blocking** | When a program sleeps waiting for something (uses zero CPU) |
| **Polling** | Repeatedly checking for changes (wastes CPU when nothing happens) |
| **Event-driven** | Letting the kernel wake you up when something happens (efficient) |

The reason event-driven uses less CPU: **the kernel is already watching the hardware**. Your program just says "wake me when something happens" and goes to sleep. No extra work is done.
